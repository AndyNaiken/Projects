---
- hosts: 172.22.2.145
  become: yes
  tasks:
    - name: Update apt cache and make sure the follwing packages is installed for Active Directory Integration
      apt:
        name: "{{ item }}"
        update_cache: yes
      loop:
        - realmd
        - libnss-sss
        - libpam-sss
        - sssd
        - sssd-tools
        - adcli
        - samba-common-bin
        - oddjob
        - oddjob-mkhomedir
        - packagekit
        
    - name: Insert a CPU Domain Name at end of resolv file.
      lineinfile:
        path: /etc/resolv.conf
        line: 'search test.qc'
        
     - name: Join system to CPU AD.
      expect:
        command: command: /bin/bash -c "/usr/sbin/realm join --user=anpe@cpu.qc.ca" -P P@ssw0rd2022
